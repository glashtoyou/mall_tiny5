<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <!-- 为了确保适当的绘制和触屏缩放，需要在 <head> 之中添加 viewport 元数据标签。 -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>赛事报名纪录管理</title>
  <!-- 新 Bootstrap 核心 CSS 文件 -->
  <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  <link rel="canonical" href="http://www.ityouknow.com/">
  <link rel="alternate" type="application/rss+xml"  href="http://www.ityouknow.com/feed.xml">

  <!-- Third-Party CSS -->
  <link rel="stylesheet" href="http://favorites.ren/bower_components/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://www.ityouknow.com/bower_components/octicons/octicons/octicons.css">
  <link rel="stylesheet" href="http://favorites.ren/bower_components/hover/css/hover-min.css">
  <link rel="stylesheet" href="http://favorites.ren/bower_components/primer-markdown/dist/user-content.min.css">
  <link rel="stylesheet" href="http://favorites.ren/assets/css/syntax.css">
  <link rel="stylesheet" href="http://favorites.ren/assets/css/gitalk.css">



  <!-- My CSS -->
  <link rel="stylesheet" href="http://favorites.ren/assets/css/common.css">

  <!-- CSS set in page -->

  <link rel="stylesheet" href="http://favorites.ren/assets/css/index.css">

  <link rel="stylesheet" href="http://favorites.ren/assets/css/sidebar-popular-repo.css">


  <!-- CSS set in layout -->


  <link href="http://apps.bdimg.com/libs/fontawesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <script type="text/javascript" src="http://favorites.ren/bower_components/jquery/dist/jquery.min.js"></script>


</head>
<style>
  body{
      font-family: Microsoft YaHei,"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
  }
</style>
<body>
<section class="jumbotron">
  <div class="container">
    <a style="margin-top:0px;
    margin-bottom: 0;
    font-size: 38px;
    font-weight: 400;
    line-height: 38px;" onclick="onSave()">&lt</a>
    <a id="site-header-brand" >
      赛事报名人员管理
    </a>
  </div>

</section>
<div id="" style="margin: 1.25rem;">
  <button type="button" class="btn btn-info" onclick="showHistory()"><span class="glyphicon glyphicon-qrcode"></span> 显示人员信息</button>
  <button type="button" class="btn btn-info" onclick="showAddHistory()"><span class="glyphicon glyphicon-sound-stereo"></span> 新增人员信息</button>
</div>

<!-- 表格信息 -->
<div id="div1" style="margin: 1.25rem;">
  <table border="1" class="table table-hover" style="display: none;" id="table1" cellspacing="2" cellpadding="2">
    <!-- <tr> <th>编号</th><th>姓名</th><th>性别</th><th>年龄</th><th>籍贯</th><th colspan="2">操作</th> </tr>
        <tr> <td>v.编号</td><td>v.姓名</td><td>v.性别</td><td>v.年龄</td><td>v.籍贯</td><td><button type="button" onclick="">删除</button></td><td><button type="button">更新</button></td> </tr>
     --></table>
</div>
<!-- 新增人员信息 -->
<div id="div2" style="display: none;margin: 1.25rem;">
  <fieldset id="field2">
    <legend>新增人员信息</legend>
    <table class="table table-hover">

      <input type="hidden"  class="form-control" name="hid" id="hid"/>
      <tr>
        <td>用户名称:</td>
        <td><input type="text" class="form-control " name="uname" id="uname" onfocus="YHMonfocu()" onblur="YHMonblus(unameIsExist)"  placeholder="请输入用户名称" required="required"  /></td>
      </tr>
      <tr>
        <td>赛事名称:</td>
        <td><input type="text" class="form-control " name="gname" id="gname"  onfocus="SSMonfocu()" onblur="SSMonblus()" placeholder="请输入赛事名称" required="required" /></td>
      </tr>
      <!--<tr>
        <td>用户邮箱:</td>
        <td>
          <input type="text" class="form-control "  name="uemail" id="uemail" onfocus="DZYXonfocu()" onblur="DZYXonblus()" placeholder="请输入用户邮箱" />
        </td>
      </tr>
      <tr>
        <td>用户联系电话:</td>
        <td><input type="text" class="form-control"  name="uphone" id="uphone" onfocus="LXDHonfocu()" onblur="LXDHonblus()" placeholder="请输入用户联系电话" /></td>
      </tr>
      <tr>
      </tr>-->
      <tr>
        <td>用户报名时间:</td>
        <td><input type="datetime-local" class="form-control"  name="htime" id="htime" pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}" step="1" value="yyyy-MM-dd HH:mm:ss" /></td>
      </tr>
      <tr>
        <td><button type="button" class="btn btn-primary" onclick="addHistory()">确定</button><button type="button" class="btn btn-warning" onclick="cancel()">取消</button></td>
      </tr>
    </table>
  </fieldset>
</div>
<!-- 更新人员信息 -->
<div id="div3" style="display: none;margin: 1.25rem;" name="div3">
  <fieldset id="field3">
    <legend>更新人员信息</legend>
    <table class="table table-hover">
      <input type="hidden"  class="form-control" name="hid" id="id"/>
      <tr>
        <td>用户名称:</td>
        <td><input type="text" class="form-control " name="uname" id="name" onfocus="YHMonfocu2()" onblur="YHMonblus2(nameIsExist)" placeholder="请输入用户名称" required="required"/></td>
      </tr>
      <tr>
        <td>赛事名称:</td>
        <td><input type="text" class="form-control " name="gname" id="name1" onfocus="SSMonfocu2()" onblur="SSMonblus2()" placeholder="请输入赛事名称" required="required" /></td>
      </tr>
     <!-- <tr>
        <td>用户邮箱:</td>
        <td>
          <input type="text" class="form-control "  name="uemail" id="email" onfocus="DZYXonfocu2()" onblur="DZYXonblus2()" placeholder="请输入用户邮箱" />
        </td>
      </tr>
      <tr>
        <td>用户联系电话:</td>
        <td><input type="text" class="form-control"  name="uphone" id="phone" onfocus="LXDHonfocu2()" onblur="LXDHonblus2()" placeholder="请输入用户联系电话" /></td>
      </tr>
      <tr>
      </tr>
      <tr>-->
        <td>用户报名时间:</td>
        <td><input type="datetime-local" class="form-control"  name="htime" id="time" pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}" step="1" value="yyyy-MM-dd HH:mm:ss" /></td>
      </tr>
      <tr>
        <td><button type="button" class="btn btn-success" onclick="updateHistory()">确定</button><button type="button" class="btn btn-warning" onclick="cancel()">取消</button></td>
      </tr>
    </table>
  </fieldset>
</div>
</body>
<script>



     var usernameFlag;
     var gnameFlag;
     function unameIsExist(){

             var username=document.getElementById("uname").value;
              if(username==""){
                usernameFlag=false;
              }else{
                $.ajax({
                      url:"http://localhost:8080/user/usernameIsExist/"+username,
                      type:"get",
                      contentType:"application/json;charset=utf-8",
                      async:false,
                      success:function(data){
                           usernameFlag=data;
                           console.log(username+usernameFlag);
                       }
                     })
              }
              return usernameFlag;

        }

     function YHMonblus(callback){
            usernameFlag=callback();
            //console.log("2"+usernameflag);
            //console.log("2"+usernameflag);
            if(usernameFlag){
                // console.log("3"+usernameflag);
                // document.getElementById('username').value ="用户名已存在";
             }else{
                   document.getElementById('uname').value="";
                   document.getElementById('uname').placeholder ="用户名不存在";
             }
                   // document.getElementById('username').value ="";

    }

     function YHMonfocu(){
            document.getElementById('uname').value ="";
            document.getElementById('uname').placeholder="请输入用户名称";
    }

     function gnameIsExist(){
             var gname=document.getElementById("gname").value;
             if(gname==""){
                gnameFlag=false;
              }else{
                $.ajax({
                      url:"http://localhost:8080/user/gnameIsExist/"+gname,
                      type:"get",
                      contentType:"application/json;charset=utf-8",
                      async:false,
                      success:function(data){
                           gnameFlag=data;
                           console.log("gname"+gnameFlag);
                       }
                     })
             }
          }

      function SSMonblus(){
            gnameIsExist();
            if(gnameFlag){

             }else{
                document.getElementById('gname').value="";
                document.getElementById('gname').placeholder="赛事不存在";
             }
         }

          function SSMonfocu(){
            document.getElementById('gname').value ="";
            document.getElementById('gname').placeholder="请输入赛事名称";
          }

       function LXDHonblus(){
        var phone=document.getElementById("uphone");
        var re =/^1[3|4|5|7|8]\d{9}$/;
        if(phone.value==""){
            document.getElementById('uphone').value="请输入联系电话";
        }
        else if(!re.test(phone.value)){
            document.getElementById('uphone').value="电话格式输入错误";
        }
        else {
            //document.getElementById('uphone').value ="";
        }
    }
    function LXDHonfocu(){
        document.getElementById('uphone').value ="";
    }

     function DZYXonblus(){
        var email=document.getElementById("uemail");
        var re= /[a-zA-Z0-9]{1,10}@[a-zA-Z0-9]{1,5}\.[a-zA-Z0-9]{1,5}/;
        if(email.value==""){
            document.getElementById('uemail').value="请输入电子邮箱";
        }
        else if(!re.test(email.value)){
            document.getElementById("uemail").value="邮箱格式不正确";
        }
        else {
           // document.getElementById('uemail').value ="";
        }
    }
    function DZYXonfocu(){
        document.getElementById('uemail').value ="";
    }



    ////////////////////////////////////////////////
     var nameFlag;
     var name1Flag;
     function nameIsExist(){

             var username=document.getElementById("name").value;
              if(username==""){
                usernameFlag=false;
              }else{
                $.ajax({
                      url:"http://localhost:8080/user/usernameIsExist/"+username,
                      type:"get",
                      contentType:"application/json;charset=utf-8",
                      async:false,
                      success:function(data){
                           nameFlag=data;
                           console.log(username+nameFlag);
                       }
                     })
              }
              return nameFlag;

        }

     function YHMonblus2(callback){
            nameFlag=callback();
            //console.log("2"+usernameflag);
            //console.log("2"+usernameflag);
            if(nameFlag){
                // console.log("3"+usernameflag);
                // document.getElementById('name').value ="用户名已存在";
             }else{
                   document.getElementById('name').value="";
                   document.getElementById('name').placeholder ="用户名不存在";
             }
                   // document.getElementById('name').value ="";

    }

     function YHMonfocu2(){
            document.getElementById('name').value ="";
             document.getElementById('name').placeholder ="请输入用户名称";
    }

     function name1IsExist(){
             var gname=document.getElementById("name1").value;
             if(gname==""){
                name1Flag=false;
              }else{
                $.ajax({
                      url:"http://localhost:8080/user/gnameIsExist/"+gname,
                      type:"get",
                      contentType:"application/json;charset=utf-8",
                      async:false,
                      success:function(data){
                           name1Flag=data;
                           console.log("gname"+name1Flag);
                       }
                     })
             }
          }

      function SSMonblus2(){
            name1IsExist();
            if(name1Flag){

             }else{
                document.getElementById('name1').value="";
                document.getElementById('name1').placeholder="赛事不存在";
             }
         }

          function SSMonfocu2(){
            document.getElementById('name1').value ="";
            document.getElementById('name1').placeholder="请输入赛事名称";
          }

       function LXDHonblus2(){
        var phone=document.getElementById("phone");
        var re =/^1[3|4|5|7|8]\d{9}$/;
        if(phone.value==""){
            document.getElementById('phone').value="请输入联系电话";
        }
        else if(!re.test(phone.value)){
            document.getElementById('phone').value="电话格式输入错误";
        }
        else {
            //document.getElementById('phone').value ="";
        }
    }
    function LXDHonfocu2(){
        document.getElementById('phone').value ="";
    }

     function DZYXonblus2(){
        var email=document.getElementById("email");
        var re= /[a-zA-Z0-9]{1,10}@[a-zA-Z0-9]{1,5}\.[a-zA-Z0-9]{1,5}/;
        if(email.value==""){
            document.getElementById('email').value="请输入电子邮箱";
        }
        else if(!re.test(email.value)){
            document.getElementById("email").value="邮箱格式不正确";
        }
        else {
           // document.getElementById('email').value ="";
        }
    }
    function DZYXonfocu2(){
        document.getElementById('email').value ="";
    }

</script>
<script type="text/javascript">


           /* var article="我已经远离了你的河流，绝不是疏远，因为我已是身居异土。远远地，依然听得到你翻山越岭、日夜兼程的脚步声，依然无比清晰地看得到你的那条洒满星星的清澈的河流。只要，也只有想起你——故乡，就是异域的那条河流也会洒满故乡的星星。无论醒着还是沉睡，都会重复着那个让人心旌摇曳的画面，星星都在你的河流里百媚地眨眼。因为那条洒满星星的河流途经我无猜的孩童，无知的少年，迷茫的青春，还要经过可知的未来，是不是今后还要交付给大海了呢？那样，大海的那些星星一定是故乡送给他们的馈赠，没有故乡的孕育，大海也会失去灵气，因为大海的源头就在故乡的这头……            星星的感情，在城市里总是被耽误。是星星的感情单一，还是城市的滥情呢？如果城市是舞台，星星就不是市民，所以也不是演员。如果天空是舞台，星星就是居民，所以能成为明星。如果河流是舞台，星星就是精灵，她就是大地的灵魂。如今，爱情在城市里就是一个错误，比金钱的质量轻百倍，所以比海洛因更危险。爱情在乡村的河流里，就有了星星的光辉，成就的是海枯石烂的传奇……                      　　晴空万里的白昼，总爱涂脂抹粉打扮一番。这样的时候，只有清泉敢从浓妆艳抹的云端踏过，只有披着满身星星的鱼儿敢从蓝天穿过，将自满表现的太阳戏弄一番。浆洗的女人们总爱把笑声抛在河面上，拍打着棒槌当爵士乐的节拍，委婉的歌声随着幸福的河水流淌，斑斓的衣服在白云间飘舞成了彩虹。我听到了大地与天空的窃语，彻底悟出了萨顶顶唱的《万物生》里的深刻与凝重：我看见山鹰在寂寞两条鱼上飞 ，两条鱼儿穿过海一样咸的河水， 一片河水落下来遇见人们破碎 ，人们在行走，身上落满山鹰的灰……                     　　睡得沉沉的夜，呵欠连连，漫长得没有尽头，无论夜几多的黑，可故乡的河流从也不会迷路，因为有星星这明亮的眼睛。你的人生没有迷路，你的梦没有迷失方向，你的未来总在奔跑的路上，是不是也是借了故乡河流里的星星做慧眼呢？如果河流看不到星星，那肯定会落魄的。如果人生看不到那条飘着星星的河流，如果梦里没有那条飘着星星的河流，如果未来的路上没有那条飘着星星的河流，你是不是都会惊慌失措呢？陌生人能通过那条河流找到你的家，如果没有了她你的心能到家吗？                    　　故乡那条洒满星星的河流，已经成了一幕刻骨铭心的风景了，我知道能刻骨铭心的是最致命的东西，我是一个能被往事打动的人，我还敢不把她珍藏在比记忆还要深刻的心头吗？如果哪天放手丢失了，我的儿子、孙子会替我捡起永远珍藏下去的。                     　　我翻阅过世界地图，也翻阅过中国地图，让我大失所望的是没能找到故乡那条洒满星星的河流。他只是奔流着的一根毛细血管，往往被大意的世人疏忽。打开谷歌地图，还是难以描绘出她窈窕的身姿。看到两旁葱葱郁郁的树，飘飘舞舞的路，歪歪斜斜的村落……才恍然大悟这是滋生生命的源头！                    　　那条河流，滋生过五谷杂粮，抚慰过萝卜白菜，滋养过冒冒失失的人们……我是数着河里的星星，翻开人生的第一页，演算过老师递过来的复杂的难题，懂得了几个因为，见识了几个所以。再后来那条河流一直陪着我，从故乡走到异乡……                      　　心中有了那条洒满星星的河流，心灵就不会陷入绝境。让我把她和与她的过往都珍藏起来了，交付给未来吧。";
			var index = 1;
			var p1 = {
				"gid":index,
				"gname":"科比",
				"gcontent":article,
                "gdesc":"就能见到你才几岁",
				"gstart":"2023-01-18 06:34:01",
				"gend":"2023-01-18 06:34:01",
			};
			index++;
			var p2 = {
				"gid":index,
				"gname":"比",
				"gcontent":article,
                "gdesc":"可是才能决定",
				"gstart":"2023-01-18 06:34:01",
				"gend":"2023-01-18 06:34:01",
			};
			index++;
			var p = new Array();//var p = [];
			p.push(p1);
			p.push(p2);
			console.log(p);*/




            var p;
			function  getListHistoryVo(){

			     $.ajax({
                      url:"/admin/history_manage/getListHistoryVo",
                      type:"get",
                      contentType:"application/json;charset=utf-8",
                      async:false,
                      success:function(data){
                          p=data;
                          //index=p[p.length-1].gid;
                          //index++;
                       }
                     })
			}
			getListHistoryVo();

			function  onSave(){
			    if(!window.confirm("是否保存")) {
			        window.location.href="/user/index";
			        return;
			    }
			   // console.log(JSON.stringify(p));
			    $.ajax({
                  url:"/admin/history_manage/receiveListHistoryVo",
                  type:"post",
                  dataType:"json",
                  async:false,
                  contentType:"application/json;charset=utf-8",
                  data:JSON.stringify(p),
                  success:function(){
                 }

             })
                 alert("success");
                 window.location.href="/user/index";

			}


			/*var index = 1;
			var p1 = {
				"uname":"就看看几点",
				"gname":"科比",
				"uemail":"2345@qq.com",
                "uphone":"就能见到你才几岁",
				"htime":"2023-01-18 06:34:01",
			};
			var p2 = {
				"uname":"就看看",
				"gname":"科",
				"uemail":"2345@qq.com",
                "uphone":"就能见到你才几岁",
				"htime":"2023-01-18 06:34:01",
			};
			var p = new Array();//var p = [];
			p.push(p1);
			p.push(p2);*/

			/**显示人员信息**/
			function showHistory(){
				//显示表格
				var index=1;
				var table1 = document.getElementById("table1");
				table1.style = "margin: 1.25rem;";
				var str = "<tr> <th>编号</th><th>用户名称</th><th>赛事名称</th><th>用户邮箱</th><th>用户联系电话</th><th>用户报名时间</th><th>操作</th> </tr>";
				for(var i=0;i<p.length;i++){
					var a = p[i];
					str += "<tr> <td>"+index+"</td><td>"+a.uname+"</td><td>"+a.gname.slice(0,10)+"..."+"</td><td>"+a.uemail+"</td><td>"+a.uphone+"</td><td>"+a.htime+"</td><td><button type='button' class='btn btn-success' onclick='showUpdateHistory("+index+")'>更新</button> &nbsp;&nbsp;   <button type='button' class='btn btn-danger' onclick='deleteHistory("+index+")'>删除</button>  </td> </tr>";
					index++;
				}
				table1.innerHTML = str;
			}
			/**显示新增人员信息**/
			function showAddHistory(){
				//隐藏更新人员界面
				var div3 = document.getElementById("div3");
				div3.style = "display: none;";
				var div2 = document.getElementById("div2");
				div2.style = "margin: 2.25rem;";
			}

			function isAddEmpty(){
                var t=document.getElementById("uname").value;
                var t1=document.getElementById("gname").value;
                var t2=document.getElementById("htime").value;
                console.log(t+" "+t1+" "+t2+" ");
                if(t==""||t1==""||t2=="") return true;
                return false;

            }
			/**新增人员信息**/
			function addHistory(){
                if(isAddEmpty()) return;
				var field2 = document.getElementById("field2");
				var a = {};//var a = new Array();
				// var a = p[index-1];
				//a.gid = index;
				a.uname = document.getElementById("uname").value;
				a.gname= document.getElementById("gname").value;
				//a.uemail = document.getElementById("uemail").value;
				//a.uphone = format(document.getElementById("uphone").value);
				a.htime= format(document.getElementById("htime").value);
				// alert(a.id+" "+a.name+" "+a.old+" "+a.sex+" "+a.area +" ");
				//数组添加表单的值
				p.push(a);
				//添加之后重新查询表单
				showHistory();

			}
			/**取消按钮，隐藏表单**/
			function cancel(){
				//隐藏新增人员信息界面
				var div2 = document.getElementById("div2");
				div2.style = "display: none;";
				//隐藏更新人员信息界面
				var div3 = document.getElementById("div3");
				div3.style = "display: none;";
			}
			/**根据id删除人员信息**/
			function deleteHistory(index){
				var flag = confirm("确定删除？");
				if(flag){
					p.splice(index-1,1);//从第i个位置开始删除一个元素
				}
				//删除完毕重新加载表单
				showHistory();
			}



			/**根据id修改人员信息**/
			function showUpdateHistory(index){
				//隐藏添加人员界面
				var div2 = document.getElementById("div2");
				div2.style = "display: none;";
				//显示更新人员界面
				var div3 = document.getElementById("div3");
				div3.style = "margin: 2.25rem";
				//根据id遍历数组得到要修改的值,然后用document对象进行修改
					var a = p[index-1];
					document.getElementById("id").value =index;
					document.getElementById("name").value = a.uname;
					document.getElementById("name1").value = a.gname;
					//document.getElementById("email").value = a.uemail;
					//document.getElementById("phone").value = a.uphone;
					document.getElementById("time").value = a.htime;
			}

			function isUpdateEmpty(){
                var t=document.getElementById("name").value;
                var t1=document.getElementById("name1").value;
                var t2=document.getElementById("time").value;
                console.log(t+" "+t1+" "+t2+" ");
                if(t==""||t1==""||t2=="") return true;
                return false;

            }

			function updateHistory(){
			        if(isUpdateEmpty()) return;
				    var index = document.getElementById("id").value;
				//再根据id把表单中的value值存入对于的p[]i数组中

					var a = p[index-1];
					//a.gid=document.getElementById("gid").value;
					a.uname=document.getElementById("name").value ;
					a.gname=document.getElementById("name1").value;
					//a.uemail=document.getElementById("email").value;
					//a.uphone=document.getElementById("phone").value;
					a.htime=format(document.getElementById("time").value);

				//重新调用表单刷新
				showHistory();
				//隐藏添加人员界面
				var div3 = document.getElementById("div3");
				div3.style = "display: none;";
			}
		   function format(time){
		       var timeFormat=time.replace("T"," ");
		       //console.log(timeFormat);
		       //console.log("yyyy-MM-dd HH:mm:ss".length)
		       if(timeFormat.length==16){
		           timeFormat+=":00";
		       }
		       return timeFormat;

		   }
		   //console.log(format("2023-01-19T00:00"));

		</script>
<style>
    .jumbotron {
    padding-top: 10px;
    padding-bottom: 10px;
    color: #fff;
}
#site-header-brand, #site-header-brand .octicon {
    margin-top: 0;
    margin-bottom: 0;
    font-size: 19px;
    font-weight: 400;
    line-height: 38px;
}

.container {
    padding-right: 15px;
    padding-left: 15px;
    margin-right: auto;
    margin-left: unset;
}
#site-header-brand, #site-header-brand .octicon {
        margin-top: 0;
        margin-bottom: 0;
        font-size: 38px;
        font-weight: 400;
        line-height: 38px;
        padding-left: 520px;
}

.line-limit-length {
overflow: hidden;
text-overflow: ellipsis;
white-space: nowrap; //文本不换行，这样超出一行的部分被截取，显示...

}

  </style>
</html>